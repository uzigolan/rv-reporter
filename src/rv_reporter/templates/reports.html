{% extends "layout.html" %}
{% block title %}Reports | RV Reporter{% endblock %}
{% block content %}
<section class="panel">
  <h1>Generated Reports</h1>
  <p class="muted">History source: <code>{{ output_folder }}</code></p>
  {% if reports %}
    <table class="table reports-table">
      <thead>
        <tr>
          <th class="name-col">Name</th>
          <th>Date/Time</th>
          <th>Engine</th>
          <th class="model-col">Model</th>
          <th class="source-col">Source</th>
          <th>Rows</th>
          <th>JSON</th>
          <th>HTML</th>
          <th>PDF</th>
          <th>OpenAI Raw</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for item in reports %}
          <tr>
            <td class="name-col">
              <span class="cell-ellipsis" title="{{ item.name }}">{{ item.name }}</span>
            </td>
            <td>{{ item.created_at }}</td>
            <td>{{ item.backend }}</td>
            <td class="model-col">
              <span class="cell-ellipsis" title="{{ item.model }}">{{ item.model }}</span>
            </td>
            <td>
              <div class="cell-ellipsis" title="{{ item.source_csv }}">{{ item.source_csv }}</div>
            </td>
            <td>{{ item.source_rows_used }}</td>
            <td><a href="{{ url_for('view_json', path=item.json_path) }}">open</a></td>
            <td><a href="{{ url_for('view_html', path=item.html_path) }}">open</a></td>
            <td>
              {% if item.pdf_path and item.pdf_path %}
                <a href="{{ url_for('view_pdf', path=item.pdf_path) }}">open</a>
              {% else %}
                <span class="muted">-</span>
              {% endif %}
            </td>
            <td>
              {% if item.raw_path and item.raw_path %}
                <a href="{{ url_for('view_raw', path=item.raw_path) }}">open</a>
              {% else %}
                <span class="muted">-</span>
              {% endif %}
            </td>
            <td>
              <form method="post" action="{{ url_for('delete_report') }}" onsubmit="return confirm('Delete this report artifacts?');">
                <input type="hidden" name="json_path" value="{{ item.json_path }}">
                <button type="submit" class="btn-link btn-danger-link">Delete</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="muted">No reports yet.</p>
  {% endif %}
</section>
{% endblock %}
